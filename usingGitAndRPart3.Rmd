---
title: 'Linking R and GitHub: part 3'
author: "Simon Brewer"
date: "10/16/2020"
output:
  html_document:
    theme: flatly
    df_print: paged
    number_sections: true
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(png)
library(grid)
```

# Working with branches in git

In the previous couple of labs, we looked at how we can use git to work with a hosting service to have both an online and local copy of your code. While this can be a useful way to work to keep track of the progress you make while working, git really shines when using it to collaborate with others. 

Collaboration git is done using the concept of branches. When you initialize a git repository, this is created with a single branch, the default. This is shown whenever anyone visits your repository, and is the initial branch that you get when you clone a repository. You should consider this as the official working version of your project, and in general, you should not work with this branch in a collaborative project. By default, GitHub names the default branch `main` in any new repository (previously this was `master`).

> Do not mess with the master. If you make changes to the master branch of a group project while other people are also working on it, your on-the-fly changes will ripple out to affect everyone else and very quickly there will be merge conflicts, weeping, rending of garments, and plagues of locusts. It’s that serious.
Unless you specify a different branch, the default branch in a repository is the base branch for new pull requests and code commits.[^1]

In a collaborative project, you should create new branches for each particular thing that you are working on. For example, each person can check out their own branch, or you can have a branch for each feature that is being added to a project. When the work on that particular feature is complete and tested, it can then be rolled back into the default `main` branch and made available there. git manages branches through a system of *checkouts* that create new branches, and *pull requests* that propose a set of changes to a higher level branch. Once the pull request has been accepted and the branch is merged back, then the branch should be deleted.

In this example, a default repository (`master`) has been established (green line). Two branches are then checked out, each set up to work on a single new feature (`feature1`, `feature2`). When feature 1 is complete, this is merged back to the `master` branch, through a pull request, followed by a second merge for feature 2. 

```{r echo=FALSE}
img <- readPNG("images/branches0.png")
grid.raster(img)
```

Note that it is also possible to checkout from a lower-level branch. If, for example, you have a working version of a new feature, you might want to check out a new branch based on this, where you could add an additional feature, or new method. This does not affect the working version, *and* doesn't mess with the main branch. In this example, a second branch is checked out from `feature1`, then merged back prior to the merge back to the main. 

```{r echo=FALSE}
img <- readPNG("images/branches1.png")
grid.raster(img)
```

If the intermediate branch is merged back and deleted, the lower level branch will be automatically re-assigned the next higher level branch

```{r echo=FALSE}
img <- readPNG("images/branches2.png")
grid.raster(img)
```

In the next section, we're going to look briefly at how to work with branches through the terminal (in case you want to work with non-R files), and then we'll go through the steps of working with branches through RStudio. 

## Working with branches from the terminal

Open a terminal and change to one of your existing repositories. For example:

```
cd /Users/username/Desktop/github/myrepo
```

You can get a list through the terminal by typing `git branch -a`. If you try this for any of your existing repositories, you should see something like the following, indicating that only the main branch exists. 

```
* main
  remotes/origin/HEAD -> origin/main
  remotes/origin/main
```

We are now going to make a new branch of this repository. I'm going to call it `devel` to represent a development branch, but feel free to use a different/more amusing name. To create this, simply type:

```
git checkout -b devel
```

As long as there is no existing branch with this name, you should see the following message:

```
    Switched to a new branch 'devel'
```

You can also use `git checkout` to switch between branches. To go back to the main branch:

```
git checkout main
```

And to switch back to the new branch:

```
git checkout devel
```

If you now run `git branch -a`, you should see the following output (or close to it):

```
* devel
  main
  remotes/origin/HEAD -> origin/main
  remotes/origin/main
```

The `*` represent a pointer and indicates the current working repository. 



To create this new branch, type “git checkout -b branchNameHere” (so, in our case, “git checkout -b hello_octo”).

Assuming nobody else has already made a branch named “hello_octo”, git returns “Switched to a new branch ‘hello_octo’.” (In the case where a branch by that name already exists, git would tell us instead “fatal: A branch named ‘hello_octo’ already exists.” No big deal, just do git checkout -b again with a new name variation).

We can also use the git checkout command to toggle back and forth between our two branches. Type “git checkout branchName” to switch to that branch. So, “git checkout master” takes you to master while “git checkout hello_octo” takes you back to hello_octo branch.
One of the key features of git is that is stores your code/project through commits, basically making a snapshot of the code at a certain point. Collaboration through git is usually done by establishing 



. For this next section, you are again going to work in pairs

- Cloning repo
- Pull requests
- Merging
- Resolving (?)


In the previous section, we went through the somewhat laborious steps of setting up your computer to talk to GitHub. We will now look at how collaborate with someone else on your repository, and the use of GitHub pages. 

You can get a list of the branches for any repository by going to the GitHub page and clicking on the [master] button in the top left. This will show you a drop down list of the existing branches. 

[^1]: https://thenewstack.io/dont-mess-with-the-master-working-with-branches-in-git-and-github/

[g4wID]: https://gitforwindows.org
[gitID]: https://git-scm.com/downloads
[hgwrID]: https://happygitwithr.com
[ghID]: https://github.com
